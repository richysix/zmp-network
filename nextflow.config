params.testing = false
params.clustering = false
params.BaseDir = "$SCRATCH/detct/grcz11"
if (params.testing) {
    params.expts = "$params.BaseDir/expt-sample-condition-test.tsv"
    params.all_counts = "$params.BaseDir/everything/filter-strict/all-test.csv.gz"
    params.big_mem = '1G'
    executor {
        name = "local"
//        retry.delay = "1000ms"
//        submitRateLimit = "1sec"
    }
} else {
//    params.expts = "$params.BaseDir/expt-sample-condition.tsv"
    params.expts = "$params.BaseDir/expt-sample-condition-tfap2.tsv"
    params.all_counts = "$params.BaseDir/everything/filter-strict/all.csv.gz"
    params.big_mem = '32G'
    executor {
        name = "sge"
        retry.delay = "1000ms"
        submitRateLimit = "1sec"
    }
}
params.ScriptDir = "$HOME/checkouts/zmp-network/scripts"
params.QsubDir = "$HOME/checkouts/zmp-network/qsub"
params.DirPrefix = "expt"
params.RefDir = "$SCRATCH/detct/grcz11/reference"
params.transcriptFile = "$params.RefDir/Danio_rerio.GRCz11.98.transcripts.tsv"
params.AnnotationFile = "$params.RefDir/Dr-e92-annotation.txt"
params.inflationParams = [1.4, 2, 4]
params.knnTestParams = "100/300/20"
params.knn = "100"
//params.threshold = ""
params.threshold = 0.6
//params.outputBase = "" // -o
params.corMeasure = "--pearson" // -c
params.labels = "-l 1" // -l
params.skipRows = "-skipr 1" // -r
params.skipCols = "-skipc 2" // -s
params.mclVersion = "14-137" // -m
params.RVersion = "4.3.1" // -v
params.PythonVersion = "3.12.4"

process {
    cpus = 1
    time = '1h'
    penv = 'smp'

    withLabel: local {
        executor = 'local'
    }

    withLabel: big_mem_retry {
        clusterOptions = "-l h_vmem=$params.big_mem"
        time = { 
            if (task.attempt > 1) {
                return '24h'
            } else {
                return '1h'
            }
        }
        errorStrategy = { task.exitStatus in 137..140 ? 'retry' : 'terminate' }
        maxRetries = 3
    }
}
